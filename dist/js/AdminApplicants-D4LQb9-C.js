import{j as e}from"./chunk-aAkv6woa.js";import{r as l}from"./chunk-CRvknJha.js";import{J as s,C as a,c as t,I as n,y as i,B as r}from"../assets/index-i8wSawhV.js";import{S as c,a as d,b as o,c as p,d as h}from"./chunk-B6dbaAgB.js";import{A as u}from"./chunk-SshbQ2oS.js";import{A as j}from"./chunk-Ez5QYH8a.js";import{c as x}from"./chunk-C2Wav99Y.js";import{a0 as m,ah as g,U as f}from"./chunk-CFjh8-P5.js";import"./chunk-oqmhCI76.js";import"./chunk-DdJ5UvfL.js";import"./chunk-Djsr9rkS.js";import"./chunk-BS4ofh5H.js";const v=()=>{const[v,w]=l.useState([]),[b,y]=l.useState([]),[N,S]=l.useState(!0),[A,k]=l.useState(""),[C,U]=l.useState("all"),[L,I]=l.useState("all"),[R,F]=l.useState([]),[$,D]=l.useState("Applied"),[P,V]=l.useState(!1);l.useEffect(()=>{E()},[]);const E=async()=>{try{const[e,l]=await Promise.all([x.getApplicants(),x.getJobPostings(!0)]);w(e),y(l)}catch(e){s.error("Failed to load applicants")}finally{S(!1)}},H=v.filter(e=>{const l=e.name?.toLowerCase().includes(A.toLowerCase())||e.email?.toLowerCase().includes(A.toLowerCase()),s="all"===C||e.status===C,a="all"===L||e.jobId===L;return l&&s&&a}),J=e=>{F(l=>l.includes(e)?l.filter(l=>l!==e):[...l,e])};return N?e.jsx(u,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):e.jsx(u,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Applicants"}),e.jsx("p",{className:"text-gray-800",children:"Manage job applications and candidate pipeline"})]}),e.jsx(a,{children:e.jsx(t,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(m,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-800"}),e.jsx(n,{placeholder:"Search applicants...",value:A,onChange:e=>k(e.target.value),className:"pl-10"})]}),e.jsxs(c,{value:C,onValueChange:U,children:[e.jsx(d,{className:"w-full lg:w-48",children:e.jsx(o,{placeholder:"Filter by status"})}),e.jsxs(p,{children:[e.jsx(h,{value:"all",children:"All Status"}),e.jsx(h,{value:"Applied",children:"Applied"}),e.jsx(h,{value:"Shortlisted",children:"Shortlisted"}),e.jsx(h,{value:"Interviewed",children:"Interviewed"}),e.jsx(h,{value:"Hired",children:"Hired"}),e.jsx(h,{value:"Rejected",children:"Rejected"})]})]}),e.jsxs(c,{value:L,onValueChange:I,children:[e.jsx(d,{className:"w-full lg:w-64",children:e.jsx(o,{placeholder:"Filter by job"})}),e.jsxs(p,{children:[e.jsx(h,{value:"all",children:"All Jobs"}),b.map(l=>e.jsx(h,{value:l.id,children:l.title},l.id))]})]})]})})}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{checked:R.length>0&&R.length===H.length,onCheckedChange:()=>{R.length===H.length?F([]):F(H.map(e=>e.id))}}),e.jsxs("span",{className:"text-sm text-gray-800",children:["Select all (",R.length,"/",H.length,")"]}),R.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{value:$,onValueChange:e=>D(e),children:[e.jsx(d,{className:"w-40",children:e.jsx(o,{})}),e.jsxs(p,{children:[e.jsx(h,{value:"Applied",children:"Applied"}),e.jsx(h,{value:"Shortlisted",children:"Shortlisted"}),e.jsx(h,{value:"Interviewed",children:"Interviewed"}),e.jsx(h,{value:"Hired",children:"Hired"}),e.jsx(h,{value:"Rejected",children:"Rejected"})]})]}),e.jsx(r,{onClick:async()=>{if(0!==R.length){V(!0);try{await Promise.all(R.map(e=>x.updateApplicantStatus(e,$))),s.success(`Updated ${R.length} applicants`),F([]),E()}catch(e){s.error("Failed to update applicants")}finally{V(!1)}}},disabled:P,children:P?"Updating...":"Apply Status"})]})]}),e.jsxs(r,{onClick:()=>{if(0===H.length)return void s.error("No applicants to export");const e=[["Name","Email","Phone","Status","Job Applied For","Application Date","Resume URL","Cover Letter","Notes"],...H.map(e=>{const l=b.find(l=>l.id===e.jobId);return[e.name||"",e.email||"",e.phone||"",e.status||"",l?.title||"Unknown Position",new Date(e.appliedAt).toLocaleDateString()||"",e.resumeUrl||"",e.coverLetter||"",e.notes||""]})].map(e=>e.map(e=>`"${e.replace(/"/g,'""')}"`).join(",")).join("\n"),l=new Blob([e],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");if(void 0!==a.download){const e=URL.createObjectURL(l);a.setAttribute("href",e),a.setAttribute("download",(()=>{const e=(new Date).toISOString().split("T")[0],l=b.find(e=>e.id===L);let s="All";return"all"!==C&&"all"!==L?s=`${C}_${l?.title?.replace(/\s+/g,"")||"Unknown"}`:"all"!==C?s=C:"all"!==L?s=l?.title?.replace(/\s+/g,"")||"Unknown":A&&(s="Filtered"),`Applicants_${s}_${e}.csv`})()),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),s.success(`Exported ${H.length} applicants to CSV`)}},variant:"outline",className:"gap-2",disabled:0===H.length,children:[e.jsx(g,{className:"w-4 h-4"}),"Download CSV (",H.length,")"]})]}),0===H.length?e.jsx(a,{children:e.jsxs(t,{className:"p-12 text-center",children:[e.jsx(f,{className:"w-12 h-12 text-gray-800 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"No applicants found"}),e.jsx("p",{className:"text-gray-800",children:A||"all"!==C||"all"!==L?"Try adjusting your search or filters":"Applications will appear here when candidates apply for your job postings"})]})}):e.jsx("div",{className:"grid gap-6",children:H.map(l=>{const s=b.find(e=>e.id===l.jobId);return e.jsx(j,{applicant:l,onUpdate:E,jobTitle:s?.title,selectable:!0,selected:R.includes(l.id),onToggleSelect:J},l.id)})})]})})};export{v as default};
